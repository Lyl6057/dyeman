webpackJsonp([57],{deV5:function(t,i){},fvzy:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("fZjL"),s=e.n(a),n=e("woOf"),c=e.n(n),o=e("pZjX"),h={name:"",components:{},data:function(){return{data:JSON.parse(localStorage.getItem("imWk")),formOp:Object,crudOp:Object,form:{},crud:[],changeList:[],loading:!1,page:{pageSize:10,currentPage:1,total:0},oldData:{},chooseData:{},getData:Function,addData:Function,delData:Function,update:Function}},watch:{},methods:{query:function(){var t=this;for(var i in this.loading=!0,this.oldData={},this.chooseData={},this.changeList=[],this.form)""===this.form[i]&&delete this.form[i];this.getData(c()(this.form,{rows:this.page.pageSize,start:this.page.currentPage})).then(function(i){var e=i.data;t.page.total=e.total,t.crud=e.records,t.crud.forEach(function(i,e){i.index=e+1;var a=t;a.$nextTick(function(){document.getElementsByClassName("el-table__row")[e].addEventListener("click",function(){a.iptChange(i)},!1),e===t.crud.length-1&&(t.$refs.crud.setCurrentRow({}),a.loading=!1)})}),0===t.crud.length&&(t.loading=!1)}).catch(function(i){t.loading=!1})},add:function(){var t=this;if(!(this.crud.length>0)||this.crud[this.crud.length-1][this.data.type.split("_")[1]]){s()(this.oldData).length>0&&(this.oldData.$cellEdit=!1);var i={index:this.crud.length+1,$cellEdit:!0};this.crud.push(i),this.$refs.crud.setCurrentRow(this.crud[this.crud.length-1]),this.iptChange(this.crud[this.crud.length-1]),this.oldData=this.crud[this.crud.length-1],this.$nextTick(function(){var i=t;document.getElementsByClassName("el-table__row")[i.crud.length-1].addEventListener("input",function(){i.iptChange(i.oldData)},!1)})}},del:function(){var t=this;if(0!==s()(this.chooseData).length){if(!this.chooseData[this.data.type.split("_")[1]]){this.crud.splice(this.chooseData.index-1,1);for(var i=0;i<this.changeList.length;i++)if(this.changeList[i].index===this.chooseData.index)return this.changeList.splice(i,1),void this.$refs.crud.setCurrentRow(this.crud[this.crud.length-1]||{})}this.$tip.cofirm(void 0===this.chooseData.prodNo?"是否确定删除缸號為 【 "+this.chooseData.batchNo+" 】 的数据?":"是否确定删除生產單號為 【 "+this.chooseData.prodNo+" 】 的数据?",this,{}).then(function(){t.delData(t.chooseData[t.data.type.split("_")[1]]).then(function(i){200===i.data.code?(t.$tip.success("删除成功"),t.crud.splice(t.chooseData.index-1,1),t.query()):t.$tip.error("删除失败")}).catch(function(i){t.$tip.error("删除失败!")})}).catch(function(i){t.$tip.warning("取消操作")})}else this.$tip.error("请选择要删除的数据!")},save:function(){for(var t=this,i=0;i<this.changeList.length;i++){if(!(this.changeList[i].barcode&&this.changeList[i].prodNo||"胚布貨物包"!==this.data.type.split("_")[0]))return void this.$tip.error("生产单号/货物包码不能为空!");if(!(this.changeList[i].barcode&&this.changeList[i].batchNo||"成品布貨物包"!==this.data.type.split("_")[0]))return void this.$tip.error("缸號/货物包码不能为空!")}this.changeList.forEach(function(i,e){i[t.data.type.split("_")[1]]?t.update(i).then(function(t){}):t.addData(i).then(function(t){})}),this.query(),this.$tip.success("保存成功!")},cellClick:function(t){this.oldData.$cellEdit=!1,this.$set(t,"$cellEdit",!0),this.oldData=t,this.chooseData=t},iptChange:function(t){if(0===this.changeList.length)this.changeList.push(t);else for(var i=0;i<this.changeList.length;i++){if(t.index===this.changeList[i].index)return void(this.changeList[i]=t);this.changeList.length-1===i&&this.changeList[i].index!=t.index&&this.changeList.push(t)}},close:function(){document.getElementsByClassName("el-dialog__headerbtn")[0].click()}},created:function(){switch(this.data.type.split("_")[0]){case"胚布貨物包":this.crudOp=o.M,this.formOp=o.N,this.getData=o._21,this.addData=o.Y,this.delData=o._0,this.update=o._31,this.formOp.column[1].display=!0,this.formOp.column[2].display=!1,this.crudOp.column[3].hide=!1,this.crudOp.column[2].hide=!0;break;case"成品布貨物包":this.crudOp=o.M,this.formOp=o.N,this.getData=o._23,this.addData=o.Z,this.delData=o._1,this.update=o._32,this.formOp.column[1].display=!1,this.formOp.column[2].display=!0,this.crudOp.column[2].hide=!1,this.crudOp.column[3].hide=!0}this.crudOp.height=" calc(100vh - 230px)",this.crudOp.column.forEach(function(t,i){0!=i&&(t.cell=!0)})},mounted:function(){},beforeDestroy:function(){this.crudOp.height=" calc(100vh - 457px)"}},r={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{attrs:{id:"rcPackage"}},[e("view-container",{attrs:{title:t.data.type.split("_")[0]}},[e("div",{staticClass:"btnList"},[e("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("新增")]),t._v(" "),e("el-button",{attrs:{type:"danger"},on:{click:t.del}},[t._v("删除")]),t._v(" "),e("el-button",{attrs:{type:"success",disabled:0===t.changeList.length},on:{click:t.save}},[t._v("保存")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.query}},[t._v("查询")]),t._v(" "),e("el-button",{attrs:{type:"warning"},on:{click:t.close}},[t._v("关闭")])],1),t._v(" "),e("div",{staticClass:"formBox"},[e("avue-form",{ref:"form",attrs:{option:t.formOp},model:{value:t.form,callback:function(i){t.form=i},expression:"form"}})],1),t._v(" "),e("div",{staticClass:"crudBox"},[e("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"crud",attrs:{id:"crud",option:t.crudOp,page:t.page,data:t.crud},on:{"update:page":function(i){t.page=i},"on-load":t.query,"current-row-change":t.cellClick}})],1)])],1)},staticRenderFns:[]};var d=e("VU/8")(h,r,!1,function(t){e("deV5")},null,null);i.default=d.exports}});
//# sourceMappingURL=57.2e5067521d531b8c0be0.js.map