webpackJsonp([8],{"8Ypo":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("fZjL"),n=a.n(i),s=a("woOf"),r=a.n(s),o=a("ifoU"),l=a.n(o),c=a("2uFj");function h(e){return{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"出仓编号",prop:"retCode",span:6,placeholder:" "},{label:"出倉日期",prop:"retDate",span:6,placeholder:" ",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"出仓类型",prop:"retType",span:6,type:"select",disabled:!0,dicData:Object(c.a)("Whse_out_type")},{label:"生產單號",prop:"prOn",span:6,placeholder:" ",disabled:!0},{label:"配料单号",prop:"batchNumber",span:6,placeholder:" ",disabled:!0},{label:"纱线编号",prop:"yarnsId",cell:!0,span:6,placeholder:" ",disabled:!0},{label:"重量",prop:"weight",cell:!0,span:6,placeholder:" ",disabled:!0}]}}function d(e){return{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh - 290px)",refreshBtn:!1,columnBtn:!1,page:!0,showSummary:!0,sumColumnList:[{label:" ",name:"weight",type:"sum"}],column:[{prop:"index",label:"序号",width:60,align:"center"},{label:"Whse_retYarnin_dtlOID",prop:"whseRetYarninDtloid",hide:!0},{label:"設備编号",prop:"equId",cell:!0,width:120,hide:"1"!=e.hide},{label:"设备名称",prop:"equName",cell:!0,width:150,hide:"1"!=e.hide},{label:"加工厂代号",prop:"refCode",cell:!0,hide:"2"!=e.hide,width:120},{label:"加工厂名稱",prop:"refName",hide:"2"!=e.hide,cell:!0,width:120},{label:"入仓编号",prop:"yinId",hide:!0,width:180},{label:"纱线系统编号",prop:"yarnsId",cell:!0,width:120},{label:"纱线名称",prop:"yarnsName",cell:!0,width:450,type:"select",dicData:Object(c.b)("basYarnsData","yarnsName","yarnsId")},{label:"批次/批号",prop:"batchNo",cell:!0,width:180},{label:"重量",prop:"weight",cell:!0,width:100,align:"right"},{label:"单位",prop:"weightUnit",cell:!0,width:100,type:"select",dicData:Object(c.a)("Whse_Transfer_unit")},{label:"纱线出仓",prop:"WhseRetyarninFk",hide:!0,width:100}]}}function u(e){return{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh - 290px)",refreshBtn:!1,columnBtn:!1,page:!0,showSummary:!0,sumColumnList:[{label:" ",name:"retWeight",type:"sum"},{label:" ",name:"traWeight",type:"sum"}],column:[{prop:"index",label:"序号",width:60,align:"center"},{label:"whseRetreatDtloid",prop:"whseRetreatDtloid",hide:!0},{label:"纱线系统编号",prop:"yarnsId",cell:!0,width:140,type:"select",dicData:Object(c.b)("whseYarninDtl/v1.0/list","yarnsId","whseYarninDtloid")},{label:"批次/批号",prop:"batchNo",cell:!0,width:180,type:"select",dicData:Object(c.b)("whseYarninDtl/v1.0/list","batchNo","whseYarninDtloid")},{label:"退回重量",prop:"retWeight",cell:!0,width:140,align:"right",hide:"4"!=e.hide&&"3"!=e.hide},{label:"单位",prop:"retCompany",cell:!0,width:100,type:"select",dicData:Object(c.a)("Whse_Transfer_unit"),hide:"4"!=e.hide&&"3"!=e.hide},{label:"调仓重量",prop:"traWeight",cell:!0,width:140,align:"right",hide:"5"!=e.hide},{label:"单位",prop:"traCompany",cell:!0,width:100,type:"select",dicData:Object(c.a)("Whse_Transfer_unit"),hide:"5"!=e.hide},{label:"退客人纱",prop:"whseRetreatFk",hide:!0,width:100}]}}var p=a("g/wl"),g=a("mtWM"),f=a.n(g);function m(e){return f()({url:"/api/whseRetyarnin/page",method:"get",params:e})}function v(e){return f()({url:"/api/whseRetyarnin",method:"post",params:e})}function b(e){return f()({url:"/api/whseRetyarnin",method:"put",params:e})}function y(e){return f()({url:"/api/whseRetyarnin?whseRetyarninoid="+e,method:"delete"})}function w(e){return f()({url:"/api/whseRetyarninDtl/page",method:"get",params:e})}function x(e){return f()({url:"/api/whseRetyarninDtl",method:"post",params:e})}function D(e){return f()({url:"/api/whseRetyarninDtl",method:"put",params:e})}function _(e){return f()({url:"/api/whseRetyarninDtl?whseRetyarninDtloid="+e,method:"delete"})}function O(e){return f()({url:"/api/vWhseRetyarninPlan/page",method:"get",params:e})}function k(e){return f()({url:"/api/vWhseRetyarninoutPlan/page",method:"get",params:e})}function C(e){return f()({url:"/api/whseRetreat/page",method:"get",params:e})}function R(e){return f()({url:"/api/whseRetreat",method:"post",params:e})}function T(e){return f()({url:"/api/whseRetreat",method:"put",params:e})}function N(e){return f()({url:"/api/whseRetreat?whseRetreatoid="+e,method:"delete"})}function $(e){return f()({url:"/api/whseRetreatDtl/page",method:"get",params:e})}function S(e){return f()({url:"/api/whseRetreatDtl",method:"post",params:e})}function L(e){return f()({url:"/api/whseRetreatDtl",method:"put",params:e})}function B(e){return f()({url:"/api/whseRetreatDtl?whseRetreatDtloid="+e,method:"delete"})}function F(e){return f()({url:"/api/whseTransfer/page",method:"get",params:e})}function I(e){return f()({url:"/api/whseTransfer",method:"post",params:e})}function V(e){return f()({url:"/api/whseTransfer",method:"put",params:e})}function W(e){return f()({url:"/api/whseTransfer?whseTransferoid="+e,method:"delete"})}function P(e){return f()({url:"/api/whseTransferDtl/page",method:"get",params:e})}function E(e){return f()({url:"/api/whseTransferDtl",method:"post",params:e})}function M(e){return f()({url:"/api/whseTransferDtl",method:"put",params:e})}function j(e){return f()({url:"/api/whseTransferDtl?whseTransferDtloid="+e,method:"delete"})}var Y={props:{datas:Object,everyThing:Object,hide:String},name:"",components:{},data:function(){return{loading:!1,page:{pageSize:10,currentPage:1,total:0},detail:{},formOp:h(),mxOp:d(this),mx:[],other:[],form:{},oldData:{},chooseData:{},changeList:[],canLeave:!1,ruleV:!1,sxV:!1,sxformOp:{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"纱线系统编号",prop:"yarnsId",span:6,placeholder:" ",display:!1},{label:"纱线名稱",prop:"yarnsName",span:6,placeholder:" ",display:!1},{label:"批号",prop:"batchNo",span:6,placeholder:" "},{label:"重量",prop:"weight",span:6,placeholder:" "}]},sxform:{},outform:{},outformOp:h(),outcrudOp:d(this),outcrud:[],sxcrud:[],sxpage:{},sxloading:!1,sxcheckList:[],planData:{},func:{},dlgTle:"選擇紗線配料"}},watch:{},methods:{getDetail:function(){var e=this;if(this.loading=!0,0===n()(this.detail).length||!this.detail.whseRetyarninoid&&!this.detail.whseRetreatoid&&!this.detail.whseTransferoid)return this.mx=[],this.mxOp.showSummary=!1,void(this.loading=!1);this.func.getDetail=w,this.func.delDetail=_,this.func.addDetail=x,this.func.updateDetail=D,"3"!==this.hide&&"4"!==this.hide||(this.func.getDetail=$,this.func.delDetail=B,this.func.addDetail=S,this.func.updateDetail=L,this.mxOp=u(this)),"5"===this.hide&&(this.func.getDetail=P,this.func.delDetail=j,this.func.addDetail=E,this.func.updateDetail=M,this.mxOp=u(this)),this.func.getDetail({rows:this.page.pageSize,start:this.page.currentPage,whseRetyarninFk:this.detail.whseRetyarninoid,whseRetreatFk:this.detail.whseRetreatoid,whseTransferFk:this.detail.whseTransferoid}).then(function(t){var a=t.data;e.page.total=a.total,e.mx=a.records,console.log(e.mx),e.oldData={},e.chooseData={},e.$refs.dlgcrud.setCurrentRow(),0===e.mx.length&&(e.loading=!1),e.mx.forEach(function(t,a){t.index=a+1,"3"!==e.hide&&"4"!==e.hide&&"5"!==e.hide||(t.batchNo=t.whseYarninDtlFk,t.yarnsId=t.whseYarninDtlFk),a===e.mx.length-1&&(e.mxOp.showSummary=!0,e.loading=!1)})})},add:function(){0!==n()(this.detail).length?this.detail.whseRetyarninoid||this.detail.whseTransferoid||this.detail.whseRetreatoid?(this.outcrudOp.column[2].hide=!0,this.outcrudOp.column[3].hide=!0,this.outcrudOp.column[4].hide=!0,this.outcrudOp.column[5].hide=!0,this.outcrudOp.column[6].hide="4"!=this.hide,this.outcrudOp.selection=!0,this.outcrudOp.showSummary=!1,this.outcrudOp.height="calc(100vh - 200px)",this.sxV=!0):this.$tip.error("请先保存出库资料"):this.$tip.error("请先选择出库明细")},del:function(){var e=this;if(null!=this.chooseData&&0!==n()(this.chooseData).length)return this.chooseData.whseRetyarninDtloid||this.chooseData.whseRetreatDtloid||this.chooseData.whseTransferDtloid?void this.$tip.cofirm("是否确定删除",this,{}).then(function(){e.func.delDetail("3"===e.hide||"4"===e.hide?e.chooseData.whseRetreatDtloid:"5"===e.hide?e.chooseData.whseTransferDtloid:e.chooseData.whseRetyarninDtloid).then(function(t){200===t.data.code?(e.$tip.success("删除成功"),e.mx.splice(e.chooseData.index-1,1),e.getDetail()):e.$tip.error("删除失败")}).catch(function(t){e.$tip.error("删除失败!")})}).catch(function(t){e.$tip.warning("取消操作")}):(this.mx.splice(this.chooseData.index-1,1),void this.$refs.dlgcrud.setCurrentRow(this.mx[this.mx.length-1]));this.$tip.error("请选择要删除的数据!")},cellClick:function(e){this.oldData=e,this.chooseData=e},close:function(){document.getElementsByClassName("el-dialog__headerbtn")[3].click()},getSxData:function(){var e=this;this.sxloading=!0;var t="";if("1"===this.hide)this.func.getPlan=O,this.dlgTle="選擇紗線配料";else{if("2"!==this.hide){if(this.sxcrud=[],"4"===this.hide)this.dlgTle="選擇采购入库",t="2";else{if("3"!==this.hide)return this.dlgTle="選擇入仓信息",void Object(p.K)(r()({rows:this.sxpage.pageSize,start:this.sxpage.currentPage})).then(function(t){var a=t.data;e.sxpage.total=a.total,e.sxcrud=a.records,e.sxcrud.forEach(function(t,a){t.index=a+1,t.yarnsName=t.yarnsId,a!==e.sxcrud.length-1||(e.sxloading=!1)})});this.dlgTle="選擇客人来纱",t="1"}return void Object(p.J)({rows:10,start:1,yinType:t}).then(function(t){for(var a=function(a){Object(p.K)(r()({rows:e.sxpage.pageSize,start:e.sxpage.currentPage,whseYarninFk:t.data.records[a].whseYarninoid})).then(function(i){var n=i.data;e.sxpage.total=n.total;for(var s=0;s<n.records.length;s++)n.records[s].yinId=t.data.records[a].yinId,s===n.records.length-1&&(e.sxcrud=e.sxcrud.concat(n.records),e.sxcrud.forEach(function(e,t){e.index=t+1,e.yarnsName=e.yarnsId}),a===t.data.records.length-1&&(e.sxloading=!1))})},i=0;i<t.data.records.length;i++)a(i)})}this.func.getPlan=k,this.dlgTle="選擇紗線配料"}this.func.getPlan(r()(this.form,{rows:this.page.pageSize,start:this.page.currentPage,retBatch:this.detail.batchNumber})).then(function(t){for(var a in 1===t.data.records.length&&(e.planData=t.data.records[0]),e.sxform)""===e.sxform[a]&&delete e.sxform[a];Object(p.K)(r()(e.sxform,{rows:e.sxpage.pageSize,start:e.sxpage.currentPage,yarnsId:e.planData.yarnsId})).then(function(t){var a=t.data;e.sxpage.total=a.total,e.sxcrud=a.records,0===e.sxcrud.length&&(e.sxloading=!1),e.sxcrud.forEach(function(t,a){t.index=a+1,t.yarnsName=t.yarnsId,a===e.sxcrud.length-1&&(e.sxloading=!1)})})})},sxselectionChange:function(e){this.sxcheckList=e,this.changeList=this.sxcheckList},check:function(){var e=this;"3"!=this.hide&&"4"!=this.hide&&"5"!=this.hide?(this.mx=this.unique(this.mx.concat(this.sxcheckList),"batchNo"),this.mx.forEach(function(t,a){t.equId=e.planData.equId,t.equName=e.planData.equName,t.refCode=e.planData.refCode,t.refName=e.planData.refName})):(this.sxcheckList.forEach(function(t,a){t.retWeight=t.weight,t.retCompany=t.weightUnit,t.traWeight=t.weight,t.traCompany=t.weightUnit,t.whseYarninDtlFk=t.whseYarninDtloid,t.index=e.mx.length+1}),this.mx=this.unique(this.mx.concat(this.sxcheckList),"whseYarninDtlFk")),this.sxclose()},save:function(){var e=this;this.loading=!0;var t=this.mx.concat(this.sxcheckList);0===t.length&&(this.loading=!1),t.forEach(function(a,i){a.whseRetyarninDtloid||a.whseRetreatDtloid||a.whseTransferDtloid||(a.whseRetyarninFk=e.detail.whseRetyarninoid,a.whseRetreatFk=e.detail.whseRetreatoid,a.whseTransferFk=e.detail.whseTransferoid,e.func.addDetail(a).then(function(e){})),i===t.length-1&&(e.getDetail(),e.$tip.success("保存成功!"))}),this.changeList=[]},sxclose:function(){this.outcrudOp.column[2].hide="1"!==this.hide,this.outcrudOp.column[3].hide="1"!==this.hide,this.outcrudOp.column[4].hide="2"!==this.hide,this.outcrudOp.column[5].hide="2"!==this.hide,this.outcrudOp.column[6].hide=!0,this.outcrudOp.selection=!1,this.outcrudOp.showSummary=!0,this.outcrudOp.height="calc(100vh - 300px)",this.sxcheckList=[],this.sxV=!1},unique:function(e,t){var a=new l.a;return e.filter(function(e){return!a.has(e[t])&&a.set(e[t],1)})}},created:function(){},mounted:function(){this.form=this.detail,"3"!==this.hide&&"4"!==this.hide&&"5"!==this.hide||(this.mxOp=u(this))},beforeDestroy:function(){}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"rcDetail"}},[a("el-row",{},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.del}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.save}},[e._v("保存")])],1),e._v(" "),a("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dlgcrud",staticStyle:{"margin-top":"-5px"},attrs:{option:e.mxOp,data:e.mx,page:e.page},on:{"update:page":function(t){e.page=t},"current-row-change":e.cellClick}})],1),e._v(" "),e.sxV?a("el-dialog",{attrs:{id:"sxPlanDlg",visible:e.sxV,"append-to-body":"",fullscreen:"","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.sxclose},on:{"update:visible":function(t){e.sxV=t}}},[a("view-container",{attrs:{title:e.dlgTle}},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"success"},on:{click:e.check}},[e._v("選擇")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSxData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.sxclose}},[e._v("关闭")])],1),e._v(" "),a("div",{staticClass:"formBox"},[a("avue-form",{ref:"sxform",attrs:{option:e.sxformOp},model:{value:e.sxform,callback:function(t){e.sxform=t},expression:"sxform"}})],1),e._v(" "),a("div",{staticClass:"crudBox"},[a("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"sxcrud",attrs:{id:"sxcrud",option:e.outcrudOp,data:e.sxcrud,page:e.sxpage},on:{"update:page":function(t){e.sxpage=t},"on-load":e.getSxData,"selection-change":e.sxselectionChange}})],1)])],1):e._e()],1)},staticRenderFns:[]};var H=a("VU/8")(Y,q,!1,function(e){a("ivXX")},null,null).exports,z=a("sLX/"),U=a("gyMJ"),J={name:"",components:{ruleDlg:z.a},props:{hide:String,tle:String},data:function(){return{changeList:[],loading:!1,sxloading:!1,outloading:!1,page:{pageSize:10,currentPage:1,total:0},outpage:{pageSize:10,currentPage:1,total:0},sxpage:{pageSize:10,currentPage:1,total:0},form:{},formOp:{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"计划编号",prop:"retBatch",span:6,placeholder:" ",labelWidth:150},{label:"设备编号",prop:"equId",span:6,placeholder:" "},{label:"生产单号",prop:"prOn",span:6,placeholder:" "},{label:"纱线批号",prop:"batchNo",span:6,placeholder:" "}]},crudOp:(e=this,{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh - 205px)",refreshBtn:!1,columnBtn:!1,page:!0,column:[{prop:"index",label:"序号",width:60,align:"center"},{label:"Whse_retYarnin_dtlOID",prop:"whseRetYarninDtloid",hide:!0},{label:"计划编号",prop:"retBatch",cell:!0,width:150,click:function(t){e.iptChange(e.chooseData)}},{label:"設備编号",prop:"equId",cell:!0,width:120,hide:"1"!=e.hide},{label:"设备名称",prop:"equName",cell:!0,width:120,hide:"1"!=e.hide},{label:"加工厂代号",prop:"refCode",cell:!0,width:120,hide:"2"!=e.hide},{label:"加工厂名称",prop:"refName",cell:!0,width:120,hide:"2"!=e.hide},{label:"生產單號",prop:"prOn",cell:!0,width:180,click:function(t){e.iptChange(e.chooseData)}},{label:"纱线编号",prop:"yarnsId",cell:!0,width:120,click:function(t){e.iptChange(e.chooseData)}},{label:"纱线名称",prop:"yarnsName",cell:!0,width:250,click:function(t){e.iptChange(e.chooseData)}},{label:"批号",prop:"batchNo",cell:!0,width:180,click:function(t){e.iptChange(e.chooseData)}},{label:"重量",prop:"weight",cell:!0,width:100,align:"right",click:function(t){e.iptChange(e.chooseData)}},{label:"锭数",prop:"everySpindle",cell:!0,align:"right",width:100,click:function(t){e.iptChange(e.chooseData)}}]}),crud:[],outform:{},outformOp:h(),outcrudOp:d(this),outcrud:[],sxform:{},sxformOp:{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"纱线系统编号",prop:"yarnsId",span:6,placeholder:" ",display:!1},{label:"纱线名稱",prop:"yarnsName",span:6,placeholder:" ",display:!1},{label:"批号",prop:"batchNo",span:6,placeholder:" "},{label:"重量",prop:"weight",span:6,placeholder:" "}]},sxcrud:[{index:0}],chooseData:{},planV:!1,ruleV:!1,sxV:!1,sxcheck:{},sxcheckList:[],canSave:!0,func:{}};var e},watch:{},methods:{getData:function(){var e=this;for(var t in"1"===this.hide?(this.func.getPlan=O,this.crudOp.column[2].label="本厂配料计划编号",this.formOp.column[0].label="本厂配料计划编号"):(this.func.getPlan=k,this.crudOp.column[2].label="外厂配料计划编号",this.formOp.column[0].label="外厂配料计划编号"),this.form)""===this.form[t]&&delete this.form[t];this.func.getPlan(r()(this.form,{rows:this.page.pageSize,start:this.page.currentPage})).then(function(t){var a=t.data;e.page.total=a.total,e.crud=a.records,0===e.crud.length&&(e.loading=!1),n()(e.chooseData).length>0&&e.$refs.crud.setCurrentRow(e.crud[e.chooseData.index-1]),e.crud.forEach(function(t,a){t.index=a+1,a===e.crud.length-1&&(e.loading=!1)})})},getDetali:function(){},getSxData:function(){var e=this;for(var t in this.sxloading=!0,this.sxform)""===this.sxform[t]&&delete this.sxform[t];Object(p.K)(r()(this.sxform,{rows:this.sxpage.pageSize,start:this.sxpage.currentPage,yarnsId:this.outform.yarnsId})).then(function(t){var a=t.data;e.sxpage.total=a.total,e.sxcrud=a.records,0===e.sxcrud.length&&(e.sxloading=!1),e.sxcrud.forEach(function(t,a){t.index=a+1,t.yarnsName=t.yarnsId,a===e.sxcrud.length-1&&(e.sxloading=!1)})})},outOrder:function(){var e=this;n()(this.chooseData).length>0?(this.outform=this.chooseData,this.outform.retType=this.hide,this.outform.batchNumber=this.chooseData.retBatch,this.outform.retDate=this.getNowTime(),Object(U.a)({code:"whse_Out_yarn"}).then(function(t){e.outform.retCode=t.data.data}),this.outcrudOp.height="calc(100vh - 300px)",this.getDetali(),this.planV=!0):this.$tip.error("請先選擇配料計劃資料!")},addDetail:function(){this.outcrudOp.column[2].hide=!0,this.outcrudOp.column[3].hide=!0,this.outcrudOp.column[4].hide=!0,this.outcrudOp.column[5].hide=!0,this.outcrudOp.selection=!0,this.outcrudOp.showSummary=!1,this.outcrudOp.height="calc(100vh - 210px)",this.sxV=!0},sxselectionChange:function(e){this.sxcheckList=this.sxcheckList.concat(e)},check:function(){var e=this,t=this.unique(this.sxcheckList,"whseYarninDtloid");this.outcrud=this.unique(this.outcrud.concat(t),"whseYarninDtloid"),this.outcrud.forEach(function(t,a){t.index=a+1,t.equId=e.outform.equId,t.equName=e.outform.equName,t.refCode=e.outform.refCode,t.refName=e.outform.refName}),this.sxclose()},planclose:function(){this.canSave=!0,this.outcrud=[],this.planV=!1},sxclose:function(){this.outcrudOp.column[2].hide="1"!==this.hide,this.outcrudOp.column[3].hide="1"!==this.hide,this.outcrudOp.column[4].hide="2"!==this.hide,this.outcrudOp.column[5].hide="2"!==this.hide,this.outcrudOp.selection=!1,this.outcrudOp.showSummary=!0,this.outcrudOp.height="calc(100vh - 300px)",this.sxV=!1},delDetail:function(){if(n()(this.sxcheck).length>0){for(var e=0;e<this.outcrud.length;e++)if(this.outcrud[e].index===this.sxcheck.index)return this.outcrud.splice(e,1),void this.$refs.outcrud1.setCurrentRow(this.outcrud[0])}else this.$tip.error("請選擇明細資料!")},add:function(){},cellDetailClick:function(e){this.sxcheck=e},cellClick:function(e){this.chooseData=e},close:function(){this.$emit("close")},del:function(){},save:function(){var e=this;this.outloading=!0,v(this.outform).then(function(t){0===e.outcrud.length&&(e.$tip.success("保存成功"),e.canSave=!1,e.$emit("save2reset"),e.outloading=!1),e.outcrud.forEach(function(a,i){a.yarnsName=a.$yarnsName,a.whseRetyarninFk=t.data.data,x(a).then(function(t){i===e.outcrud.length-1&&(e.$tip.success("保存成功"),e.canSave=!1,e.$emit("save2reset"),e.outloading=!1)})})})},unique:function(e,t){var a=new l.a;return e.filter(function(e){return!a.has(e[t])&&a.set(e[t],1)})},getNowTime:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=e.getHours(),s=e.getMinutes(),r=e.getSeconds();return t+"-"+(a=a<10?"0"+a:a)+"-"+(i=i<10?"0"+i:i)+" "+(n=n<10?"0"+n:n)+":"+(s=s<10?"0"+s:s)+":"+(r=r<10?"0"+r:r)}},created:function(){},mounted:function(){this.outcrudOp=d(this)},beforeDestroy:function(){}},X={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"outPlan"}},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"warning"},on:{click:function(t){e.ruleV=!0}}},[e._v("編號規則配置")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.outOrder}},[e._v("生成出庫單")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.close}},[e._v("关闭")])],1),e._v(" "),a("div",{staticClass:"formBox"},[a("avue-form",{ref:"form",attrs:{option:e.formOp},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1),e._v(" "),a("el-row",{staticClass:"crudBox"},[a("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"crud",staticStyle:{"margin-top":"-5px"},attrs:{id:"crud",option:e.crudOp,data:e.crud,page:e.page},on:{"update:page":function(t){e.page=t},"on-load":e.getData,"current-row-change":e.cellClick}})],1),e._v(" "),e.planV?a("el-dialog",{attrs:{id:"sxPlanDlg",visible:e.planV,fullscreen:"","append-to-body":"","close-on-click-modal":!1,"before-close":e.planclose},on:{"update:visible":function(t){e.planV=t}}},[a("view-container",{directives:[{name:"loading",rawName:"v-loading",value:e.outloading,expression:"outloading"}],attrs:{title:e.tle+"出庫單","element-loading-text":"正在保存中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"success",disabled:!e.canSave},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.planclose}},[e._v("关闭")])],1),e._v(" "),a("div",{staticClass:"formBox"},[a("avue-form",{ref:"form",attrs:{option:e.outformOp},model:{value:e.outform,callback:function(t){e.outform=t},expression:"outform"}})],1),e._v(" "),a("view-container",{attrs:{title:e.tle+"出庫單明細"}},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"primary",disabled:!e.canSave},on:{click:e.addDetail}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"danger",disabled:!e.canSave},on:{click:e.delDetail}},[e._v("删除")])],1),e._v(" "),a("div",{staticClass:"crudBox"},[a("avue-crud",{ref:"outcrud1",attrs:{id:"outcrud",option:e.outcrudOp,data:e.outcrud,page:e.outpage},on:{"update:page":function(t){e.outpage=t},"on-load":e.getDetali,"current-row-change":e.cellDetailClick}})],1),e._v(" "),e.sxV?a("el-dialog",{attrs:{id:"sxPlanDlg",visible:e.sxV,"append-to-body":"",fullscreen:"","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.sxclose},on:{"update:visible":function(t){e.sxV=t}}},[a("view-container",{attrs:{title:"選擇紗線配料"}},[a("div",{staticClass:"btnList"},[a("el-button",{attrs:{type:"success"},on:{click:e.check}},[e._v("選擇")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSxData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.sxclose}},[e._v("关闭")])],1),e._v(" "),a("div",{staticClass:"formBox"},[a("avue-form",{ref:"sxform",attrs:{option:e.sxformOp},model:{value:e.sxform,callback:function(t){e.sxform=t},expression:"sxform"}})],1),e._v(" "),a("div",{staticClass:"crudBox"},[a("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"sxcrud",attrs:{id:"sxcrud",option:e.outcrudOp,data:e.sxcrud,page:e.sxpage},on:{"update:page":function(t){e.sxpage=t},"on-load":e.getSxData,"selection-change":e.sxselectionChange}})],1)])],1):e._e()],1)],1)],1):e._e(),e._v(" "),e.ruleV?a("el-dialog",{attrs:{id:"wkRuleDlg",visible:e.ruleV,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.ruleV=t}}},[a("rule-dlg",{ref:"rule",attrs:{rcType:"whse_Out_yarn"},on:{close:function(t){e.ruleV=!1}}})],1):e._e()],1)},staticRenderFns:[]};var K=a("VU/8")(J,X,!1,function(e){a("B7Ib")},null,null).exports,Z={name:"",components:{temDlg:H,ruleDlg:z.a,tabPlan:K},data:function(){return{dialogVisible:!1,loading:!1,data:JSON.parse(localStorage.getItem("imWk")),page:{pageSize:10,currentPage:1,total:0},hide:JSON.parse(localStorage.getItem("imWk")).type.split("_")[1],formOp:{},form:{},crudOp:{},crud:[],detail:{},everyThing:{},oldData:{},chooseData:{},changeList:[],tabs:"tabs1",ruleV:!1}},watch:{},methods:{getData:function(){var e,t=this;for(var a in this.loading=!0,this.changeList=[],this.everyThing={mainF:(e=this,{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"出仓编号",prop:"retCode",span:6,placeholder:" "},{label:"出倉日期",prop:"retDate",span:6,placeholder:" ",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"配料单号",prop:"batchNumber",span:6,placeholder:" ",display:"1"===e.hide||"1"===e.hide}]}),mainC:function(e){return{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh - 290px)",refreshBtn:!1,columnBtn:!1,page:!0,column:[{label:"whseRetyarninoid",prop:"whseRetyarninoid",hide:!0},{label:"序号",prop:"index",width:60,align:"center"},{label:"创建日期",prop:"sysCreated",hide:!0,type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",focus:function(t){e.iptChange(e.chooseData)},change:function(t){""===t.value&&e.iptChange(e.chooseData)},align:"center"},{label:"记录删除标记",prop:"sysDeleted",hide:!0},{label:"出仓编号",prop:"retCode",cell:!0,width:160,change:function(t){e.iptChange(e.chooseData)}},{label:"出仓类型",prop:"retType",cell:!1,width:90,type:"select",dicData:Object(c.a)("Whse_out_type"),change:function(t){e.iptChange(e.chooseData)}},{label:"出倉日期",prop:"retDate",cell:!0,type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",focus:function(t){e.iptChange(e.chooseData)},change:function(t){""===t.value&&e.iptChange(e.chooseData)},align:"center",width:190},{label:"调入仓",prop:"traIn",cell:!0,width:120,hide:"5"!==e.hide,change:function(t){""===t.value&&e.iptChange(e.chooseData)},click:function(){e.iptChange(e.chooseData)},type:"select",dicData:Object(c.b)("whseWarehouse","warehouseName","whseWarehouseoid")},{label:"调出仓",prop:"traOut",cell:!0,width:120,hide:"5"!==e.hide,change:function(t){""===t.value&&e.iptChange(e.chooseData)},type:"select",dicData:Object(c.b)("whseWarehouse","warehouseName","whseWarehouseoid"),click:function(){e.iptChange(e.chooseData)}},{label:"配料单号",prop:"batchNumber",cell:!0,width:180,hide:"1"!==e.hide&&"2"!==e.hide,change:function(t){""===t.value&&e.iptChange(e.chooseData)},click:function(){e.iptChange(e.chooseData)}},{label:"操作员",prop:"sysCreatedby",cell:!0,width:100,type:"select",dicData:Object(c.d)("ucmlUserList","employeename","ucmlUseroid")}]}}(this),dlgF1:h,dlgC1:d(this),dlgC2:{},dlgPp:"24:0",func:m,addF:v,delF:y,updateF:b},"3"!==this.hide&&"4"!==this.hide||(this.everyThing.func=C,this.everyThing.addF=R,this.everyThing.delF=N,this.everyThing.updateF=T),"5"===this.hide&&(this.everyThing.func=F,this.everyThing.addF=I,this.everyThing.delF=W,this.everyThing.updateF=V),this.form)""===this.form[a]&&delete this.form[a];this.everyThing.func(r()(this.form,{rows:this.page.pageSize,start:this.page.currentPage,retType:JSON.parse(localStorage.getItem("imWk")).type.split("_")[1]})).then(function(e){var a=e.data;t.page.total=a.total,t.crud=a.records,0===t.crud.length&&(t.loading=!1),t.crud.forEach(function(e,a){e.finStatus=String(e.finStatus),e.index=a+1,a===t.crud.length-1&&setTimeout(function(){t.loading=!1},200)})}).catch(function(e){t.loading=!1})},add:function(){var e=this;if(!(this.crud.length>0)||this.crud[this.crud.length-1].whseRetyarninoid||this.crud[this.crud.length-1].whseRetreatoid||this.crud[this.crud.length-1].whseTransferoid){n()(this.oldData).length>0&&(this.oldData.$cellEdit=!1);var t={index:this.crud.length+1,$cellEdit:!0,retType:this.hide,retCode:"",retDate:this.getNowTime()};Object(U.a)({code:"whse_Out_yarn"}).then(function(e){t.retCode=e.data.data}),this.crud.push(t),this.$refs.mainCrud.setCurrentRow(this.crud[this.crud.length-1]),this.iptChange(this.crud[this.crud.length-1]),this.oldData=this.crud[this.crud.length-1],this.$nextTick(function(){var t=e;document.getElementsByClassName("el-table__row")[t.crud.length-1].addEventListener("input",function(){t.iptChange(t.oldData)},!1)})}},iptChange:function(e){if(0===this.changeList.length)this.changeList.push(e);else for(var t=0;t<this.changeList.length;t++){if(e.index===this.changeList[t].index)return void(this.changeList[t]=e);this.changeList.length-1===t&&this.changeList[t].index!=e.index&&this.changeList.push(e)}},del:function(){var e=this;if(0!==n()(this.chooseData).length){if(!this.chooseData.whseRetyarninoid&&!this.chooseData.whseRetreatoid&&!this.chooseData.whseTransferoid){this.crud.splice(this.chooseData.index-1,1);for(var t=0;t<this.changeList.length;t++)if(this.changeList[t].index===this.chooseData.index)return this.changeList.splice(t,1),void this.$refs.mainCrud.setCurrentRow(this.crud[this.crud.length-1])}this.$tip.cofirm("是否确定删除",this,{}).then(function(){e.everyThing.delF("3"===e.hide||"4"===e.hide?e.chooseData.whseRetreatoid:"5"===e.hide?e.chooseData.whseTransferoid:e.chooseData.whseRetyarninoid).then(function(t){200===t.data.code?(e.$tip.success("删除成功"),e.crud.splice(e.chooseData.index-1,1),e.getData()):e.$tip.error("删除失败")}).catch(function(t){e.$tip.error("删除失败!")})}).catch(function(t){e.$tip.warning("取消操作")})}else this.$tip.error("请选择要删除的数据!")},cellClick:function(e){var t=this;this.$refs.tem.changeList.length>0?this.$tip.cofirm("是否保存当前选择的纱线配料资料?",this,{}).then(function(){t.$refs.tem.save(),t.$nextTick(function(){t.$refs.mainCrud.setCurrentRow(t.oldData)})}).catch(function(a){t.oldData.$cellEdit=!1,t.$set(e,"$cellEdit",!0),t.oldData=e,t.chooseData=e,t.$refs.tem.detail=e,t.$refs.tem.changeList=[],t.$refs.tem.getDetail()}):(this.oldData.$cellEdit=!1,this.$set(e,"$cellEdit",!0),this.oldData=e,this.chooseData=e,this.$refs.tem.detail=e,this.$refs.tem.getDetail())},save:function(){for(var e=this,t=0;t<this.changeList.length;t++)if(!this.changeList[t].retCode||!this.changeList[t].retDate)return void this.$tip.error("出仓编号/日期不能为空!");this.changeList.forEach(function(t,a){t.whseRetyarninoid||t.whseRetreatoid||t.whseTransferoid?e.everyThing.updateF(t).then(function(e){}):e.everyThing.addF(t).then(function(e){})}),this.getData(),this.$tip.success("保存成功!")},close:function(){document.getElementsByClassName("el-dialog__headerbtn")[0].click()},getNowTime:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),n=e.getHours(),s=e.getMinutes(),r=e.getSeconds();return t+"-"+(a=a<10?"0"+a:a)+"-"+(i=i<10?"0"+i:i)+" "+(n=n<10?"0"+n:n)+":"+(s=s<10?"0"+s:s)+":"+(r=r<10?"0"+r:r)}},created:function(){},mounted:function(){},beforeDestroy:function(){}},A={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"rc"}},[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.tabs,callback:function(t){e.tabs=t},expression:"tabs"}},[a("el-tab-pane",{attrs:{label:e.data.type.split("_")[0]+"出库",name:"tabs1"}},[a("div",{staticClass:"btnList"},["1"!=e.hide&&"2"!=e.hide?a("el-button",{attrs:{type:"warning"},on:{click:function(t){e.ruleV=!0}}},[e._v("編號規則配置")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getData}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"warning"},on:{click:e.close}},[e._v("关闭")])],1),e._v(" "),a("div",{staticClass:"formBox"},[a("avue-form",{ref:"form",attrs:{option:e.everyThing.mainF},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1),e._v(" "),a("el-row",{staticClass:"crudBox"},[a("el-col",{attrs:{span:"5"===e.hide?12:10}},[a("view-container",{attrs:{title:e.data.type.split("_")[0]+"出库资料"}},[a("div",{staticClass:"btnList"},["1"!=e.hide&&"2"!=e.hide?a("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("新增")]):e._e(),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.del}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"success",disabled:0===e.changeList.length},on:{click:e.save}},[e._v("保存")])],1),e._v(" "),a("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"mainCrud",staticStyle:{"margin-top":"-5px"},attrs:{id:"crud",option:e.everyThing.mainC,data:e.crud,page:e.page},on:{"update:page":function(t){e.page=t},"on-load":e.getData,"current-row-change":e.cellClick}})],1)],1),e._v(" "),a("el-col",{attrs:{span:"5"===e.hide?12:14}},[a("view-container",{attrs:{title:e.data.type.split("_")[0]+"出库明细"}},[a("tem-dlg",{ref:"tem",attrs:{datas:e.data,everyThing:e.everyThing,hide:e.hide}})],1)],1)],1)],1),e._v(" "),"1"===e.hide||"2"===e.hide?a("el-tab-pane",{attrs:{label:"未出倉紗線配料計劃",name:"tabs2"}},[a("tab-plan",{attrs:{hide:e.hide,tle:e.data.type.split("_")[0]},on:{close:e.close,save2reset:e.getData}})],1):e._e()],1),e._v(" "),e.ruleV?a("el-dialog",{attrs:{id:"wkRuleDlg",visible:e.ruleV,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.ruleV=t}}},[a("rule-dlg",{ref:"rule",attrs:{rcType:"whse_Out_yarn"},on:{close:function(t){e.ruleV=!1}}})],1):e._e()],1)},staticRenderFns:[]};var G=a("VU/8")(Z,A,!1,function(e){a("MD4T")},null,null);t.default=G.exports},B7Ib:function(e,t){},MD4T:function(e,t){},ivXX:function(e,t){}});
//# sourceMappingURL=8.fbf5c10a90b6aa54a854.js.map