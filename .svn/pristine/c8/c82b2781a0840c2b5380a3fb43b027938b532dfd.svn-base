webpackJsonp([2],{QBuR:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("fZjL"),c=i.n(a),n=i("woOf"),h=i.n(n),s=i("2uFj");function o(t){return{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"入仓编号",prop:"yinId",span:6,placeholder:" ",disabled:!0},{label:"入仓日期",prop:"yinDate",span:6,placeholder:" ",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",disabled:!0},{label:"客户名称",prop:"custName",span:6,placeholder:" ",disabled:!0,type:"select",display:"2"===t.hide,dicData:Object(s.b)("basCustomer","custName","custName")},{label:"客人通知单",prop:"custNotice",span:6,placeholder:" ",disabled:!0}]}}function l(t){return{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh - 290px)",refreshBtn:!1,columnBtn:!1,page:!0,roykey:"whseFinishedclothinDtloid",showSummary:!0,sumColumnList:[{label:" ",name:"weight",type:"sum"},{label:" ",name:"countingNo",type:"sum"}],column:[{prop:"index",label:"序号",width:60,align:"center"},{label:"Whse_FinishedclothIn_dtlOID",prop:"whseFinishedclothinDtloid",hide:!0},{label:"缸号",prop:"batchNo",cell:!0,width:230,click:function(){2!=t.hide&&(t.choiceV=!t.choiceV,t.choiceField="batchNo",t.oldData=t.chooseData,t.choiceTarget=t.oldData,t.choiceTle="成品布貨物包",t.iptChange(t.chooseData))}},{label:"疋数",prop:"countingNo",cell:"1"!==t.hide&&"3"!==t.hide,width:120,align:"right",click:function(e){t.iptChange(t.chooseData)}},{label:"重量",prop:"weight",cell:"1"!==t.hide&&"3"!==t.hide,width:120,align:"right",click:function(e){t.iptChange(t.chooseData)}},{label:"重量单位",prop:"weightUnit",cell:"1"!==t.hide&&"3"!==t.hide,width:100,type:"select",dicData:Object(s.a)("Whse_Transfer_unit"),click:function(e){t.iptChange(t.chooseData)}},{label:"布票号",prop:"fabticket",cell:"1"!==t.hide&&"3"!==t.hide,width:230,click:function(e){t.iptChange(t.chooseData)}},{label:"成品布入仓",prop:"whseFinishedclothinFk",hide:!0,width:100}]}}var d=i("Tjk1"),r=i("g/wl"),u={props:{datas:Object,everyThing:Object,hide:String},name:"",components:{choice:d.a},data:function(){return{loading:!1,page:{pageSize:10,currentPage:1,total:0},detail:{},formOp:o(this),mxOp:l(this),mx:[{}],other:[],form:{},oldData:{},chooseData:{},changeList:[],canLeave:!1,choiceV:!1,choiceTle:"",choiceTarget:{},choiceField:"",choiceQ:{}}},watch:{},methods:{getDetail:function(){var t=this;if(this.loading=!0,0===c()(this.detail).length||!this.detail.whseFinishedclothinoid)return this.mx=[],this.mxOp.showSummary=!1,void(this.loading=!1);this.oldData={},this.chooseData={},Object(r.z)({rows:this.page.pageSize,start:this.page.currentPage,whseFinishedclothinFk:this.detail.whseFinishedclothinoid}).then(function(e){var i=e.data;t.page.total=i.total,t.changeList=[],t.$nextTick(function(){t.$refs.dlgcrud.setCurrentRow({}),t.mxOp.showSummary=!0}),t.mx=i.records,0===t.mx.length&&(t.loading=!1),t.mx.forEach(function(e,i){e.index=i+1,i===t.mx.length-1&&(t.loading=!1)})})},add:function(){0!==c()(this.detail).length?this.detail.whseFinishedclothinoid?this.mx.length>0&&!this.mx[this.mx.length-1].whseFinishedclothinDtloid||(c()(this.oldData).length>0&&(this.oldData.$cellEdit=!1),this.mx.push({index:this.mx.length+1,$cellEdit:!0,whseFinishedclothinFk:this.detail.whseFinishedclothinoid}),this.$refs.dlgcrud.setCurrentRow(this.mx[this.mx.length-1]),this.iptChange(this.mx[this.mx.length-1]),this.oldData=this.mx[this.mx.length-1]):this.$tip.error("请先保存入库资料"):this.$tip.error("请先选择入库资料")},iptChange:function(t){if(0===this.changeList.length)this.changeList.push(t);else for(var e=0;e<this.changeList.length;e++){if(t.index===this.changeList[e].index)return void(this.changeList[e]=t);this.changeList.length-1===e&&this.changeList[e].index!=t.index&&this.changeList.push(t)}},del:function(){var t=this;if(0!==c()(this.chooseData).length){if(!this.chooseData.whseFinishedclothinDtloid){this.mx.splice(this.chooseData.index-1,1);for(var e=0;e<this.changeList.length;e++)if(this.changeList[e].index===this.chooseData.index)return this.changeList.splice(e,1),void this.$refs.dlgcrud.setCurrentRow(this.mx[this.mx.length-1])}this.$tip.cofirm("是否确定删除",this,{}).then(function(){Object(r.n)(t.chooseData.whseFinishedclothinDtloid).then(function(e){200===e.data.code?(t.$tip.success("删除成功"),t.mx.splice(t.chooseData.index-1,1),t.getDetail()):t.$tip.error("删除失败")}).catch(function(e){t.$tip.error("删除失败!")})}).catch(function(e){t.$tip.warning("取消操作")})}else this.$tip.error("请选择要删除的数据!")},cellClick:function(t){this.oldData.$cellEdit=!1,this.$set(t,"$cellEdit",!0),this.oldData=t,this.chooseData=t},save:function(){for(var t=0;t<this.changeList.length;t++)if(!this.changeList[t].batchNo||!this.changeList[t].countingNo)return this.$tip.error("缸号/疋数不能为空!"),void(this.canLeave=!0);this.changeList.forEach(function(t,e){t.whseFinishedclothinDtloid?Object(r.M)(t).then(function(t){}):Object(r.b)(t).then(function(t){})}),this.changeList=[],this.getDetail(),this.$tip.success("保存成功!")},close:function(){document.getElementsByClassName("el-dialog__headerbtn")[3].click()},choiceData:function(t){if(0!==c()(t).length){for(var e in this.oldData.$cellEdit=!1,this.choiceTarget[this.choiceField]=t[this.choiceField],this.oldData.$cellEdit=!0,"成品布貨物包"===this.choiceTle&&(this.choiceTarget.weight=t.weight,this.choiceTarget.weightUnit=t.weightUnit,this.choiceTarget.prodNo=t.prodNo,this.choiceTarget.fabticket=t.fabticket,this.choiceTarget.countingNo=t.countingNo),t)delete t[e];for(var e in this.choiceQ)delete this.choiceQ[e];this.choiceV=!1}else this.choiceV=!1}},created:function(){},mounted:function(){this.form=this.detail},beforeDestroy:function(){}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"rcDetail"}},[i("el-row",{},[i("div",{staticClass:"btnList"},[i("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("新增")]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:t.del}},[t._v("删除")]),t._v(" "),i("el-button",{attrs:{type:"success",disabled:0===t.changeList.length},on:{click:t.save}},[t._v("保存")])],1),t._v(" "),i("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dlgcrud",staticStyle:{"margin-top":"-5px"},attrs:{option:t.mxOp,data:t.mx,page:t.page},on:{"update:page":function(e){t.page=e},"current-row-change":t.cellClick,"on-load":t.getDetail}})],1),t._v(" "),t.choiceV?i("choice",{attrs:{choiceV:t.choiceV,choiceTle:t.choiceTle,choiceQ:t.choiceQ,dlgWidth:"60%"},on:{choiceData:t.choiceData,close:function(e){t.choiceV=!1}}}):t._e()],1)},staticRenderFns:[]};var g=i("VU/8")(u,p,!1,function(t){i("SFsc")},null,null).exports,f=i("sLX/"),m=i("gyMJ"),y={name:"",components:{temDlg:g,ruleDlg:f.a,choice:d.a},data:function(){return{dialogVisible:!1,loading:!1,data:JSON.parse(localStorage.getItem("imWk")),page:{pageSize:10,currentPage:1,total:0},hide:JSON.parse(localStorage.getItem("imWk")).type.split("_")[1],formOp:{},form:{},crudOp:{},crud:[],detail:{},everyThing:{},oldData:{},chooseData:{},changeList:[],ruleV:!1,choiceV:!1,choiceTle:"",choiceTarget:{},choiceField:"",choiceQ:{}}},watch:{},methods:{getData:function(){var t,e=this;for(var i in this.loading=!0,this.everyThing={mainF:(t=this,{submitBtn:!1,emptyBtn:!1,labelWidth:130,column:[{label:"入仓编号",prop:"yinId",span:6,placeholder:" "},{label:"入仓日期",prop:"yinDate",span:6,placeholder:" ",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"检验状态",prop:"yinStatus",span:6,placeholder:" ",type:"select",dicData:Object(s.a)("whse_yinstatus")},{label:"客户名称",prop:"custName",span:6,placeholder:" ",type:"select",display:"2"===t.hide,dicData:Object(s.b)("basCustomer","custName","custName")},{label:"财务状态",prop:"finStatus",span:6,placeholder:" ",type:"select",display:"1"===t.hide,dicData:Object(s.a)("whse_finStatus")}]}),mainC:function(t){return{menu:!1,addBtn:!1,border:!0,highlightCurrentRow:!0,height:"calc(100vh -290px)",refreshBtn:!1,columnBtn:!1,page:!0,column:[{label:"成品布入仓主键OID",prop:"whseFinishedclothinoid",hide:!0},{label:"序号",prop:"index",width:60,align:"center"},{label:"创建日期",prop:"sysCreated",hide:!0,type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",focus:function(e){t.iptChange(t.chooseData)},change:function(e){""===e.value&&t.iptChange(t.chooseData)},align:"center"},{label:"记录删除标记",prop:"sysDeleted",hide:!0},{label:"入仓编号",prop:"yinId",cell:!0,width:160,change:function(e){t.iptChange(t.chooseData)}},{label:"入仓类型",prop:"yinType",cell:!1,width:140,type:"select",dicData:Object(s.a)("Whse_FinishedclothType"),change:function(e){t.iptChange(t.chooseData)}},{label:"入仓日期",prop:"yinDate",cell:!0,type:"datetime",format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",focus:function(e){t.iptChange(t.chooseData)},change:function(e){""===e.value&&t.iptChange(t.chooseData)},width:190,align:"center"},{label:"客户",prop:"custName",cell:!0,hide:"2"!==t.hide,width:150,change:function(e){""===e.value&&t.iptChange(t.chooseData)},click:function(){t.choiceV=!t.choiceV,t.choiceField="custName",t.oldData=t.chooseData,t.choiceTarget=t.oldData,t.choiceTle="客戶編號",t.iptChange(t.chooseData)}},{label:"客户代码",prop:"custCode",cell:!1,width:150,hide:!0,change:function(e){""===e.value&&t.iptChange(t.chooseData)},click:function(){t.iptChange(t.chooseData)}},{label:"客人通知单",prop:"custNotice",cell:!0,hide:"2"!==t.hide,width:150,change:function(e){""===e.value&&t.iptChange(t.chooseData)},click:function(){t.iptChange(t.chooseData)}},{label:"检验状态",prop:"yinStatus",cell:!0,width:110,hide:"2"==t.hide,type:"select",dicData:Object(s.a)("whse_yinstatus"),change:function(e){""===e.value&&t.iptChange(t.chooseData)},click:function(){t.iptChange(t.chooseData)}},{label:"财务状态",prop:"finStatus",cell:!0,width:120,type:"select",hide:"1"!==t.hide,dicData:Object(s.a)("whse_finStatus"),change:function(e){""===e.value&&t.iptChange(t.chooseData)},click:function(){t.iptChange(t.chooseData)}},{label:"备注",prop:"remarks",cell:!0,hide:"2"!==t.hide,width:250,change:function(e){t.iptChange(t.chooseData)}},{label:"创建用户",prop:"sysCreatedby",hide:!0},{label:"授权用户",prop:"sysReplacement",hide:!0},{label:"所属岗位",prop:"sysPostn",hide:!0},{label:"所属部门",prop:"sysDivision",hide:!0},{label:"所属组织",prop:"sysOrg",hide:!0},{label:"最后修改用户",prop:"sysLastUpdBy",hide:!0,width:150},{label:"最后修改日期",prop:"sysLastUpd",hide:!0,type:"datetime",width:180,format:"yyyy-MM-dd HH:mm:ss",valueFormat:"yyyy-MM-dd HH:mm:ss",focus:function(e){t.iptChange(t.chooseData)},change:function(e){""===e.value&&t.iptChange(t.chooseData)},align:"center"}]}}(this),dlgF1:o,dlgC1:l,dlgC2:{},dlgPp:"24:0"},this.form)""===this.form[i]&&delete this.form[i];Object(r.y)(h()(this.form,{rows:this.page.pageSize,start:this.page.currentPage,yinType:JSON.parse(localStorage.getItem("imWk")).type.split("_")[1]})).then(function(t){var i=t.data;e.page.total=i.total,e.changeList=[],e.crud=i.records,0===e.crud.length&&(e.loading=!1),e.crud.forEach(function(t,i){t.finStatus=String(t.finStatus),t.index=i+1,i===e.crud.length-1&&(e.$refs.crud.setCurrentRow(0),e.loading=!1)}),e.$refs.tem.mx=[]}).catch(function(t){e.loading=!1})},add:function(){var t=this;if(!(this.crud.length>0)||this.crud[this.crud.length-1].whseFinishedclothinoid){c()(this.oldData).length>0&&(this.oldData.$cellEdit=!1);var e={index:this.crud.length+1,$cellEdit:!0,yinType:this.hide,yinId:""};Object(m.a)({code:"whse_In_finished"}).then(function(t){e.yinId=t.data.data}),this.crud.push(e),this.$refs.crud.setCurrentRow(this.crud[this.crud.length-1]),this.iptChange(this.crud[this.crud.length-1]),this.oldData=this.crud[this.crud.length-1],this.$nextTick(function(){var e=t;document.getElementsByClassName("el-table__row")[e.crud.length-1].addEventListener("input",function(){e.iptChange(e.oldData)},!1)})}},iptChange:function(t){if(0===this.changeList.length)this.changeList.push(t);else for(var e=0;e<this.changeList.length;e++){if(t.index===this.changeList[e].index)return void(this.changeList[e]=t);this.changeList.length-1===e&&this.changeList[e].index!=t.index&&this.changeList.push(t)}},del:function(){var t=this;if(0!==c()(this.chooseData).length){if(!this.chooseData.whseFinishedclothinoid){this.crud.splice(this.chooseData.index-1,1);for(var e=0;e<this.changeList.length;e++)if(this.changeList[e].index===this.chooseData.index)return this.changeList.splice(e,1),void this.$refs.crud.setCurrentRow(this.crud[this.crud.length-1])}this.$tip.cofirm("是否确定删除",this,{}).then(function(){Object(r.m)(t.chooseData.whseFinishedclothinoid).then(function(e){200===e.data.code?(t.$tip.success("删除成功"),t.crud.splice(t.chooseData.index-1,1),t.getData()):t.$tip.error("删除失败")}).catch(function(e){t.$tip.error("删除失败!")})}).catch(function(e){t.$tip.warning("取消操作")})}else this.$tip.error("请选择要删除的数据!")},cellClick:function(t){var e=this;if(this.$refs.tem.canLeave)return this.oldData.$cellEdit=!1,this.$set(t,"$cellEdit",!0),this.oldData=t,this.chooseData=t,void(this.$refs.tem.canLeave=!1);this.$refs.tem.changeList.length>0?this.$tip.cofirm("是否保存当前修改的批号资料?",this,{}).then(function(){e.$refs.tem.save(),e.$nextTick(function(){e.$refs.crud.setCurrentRow(e.oldData)})}).catch(function(i){e.oldData.$cellEdit=!1,e.$set(t,"$cellEdit",!0),e.oldData=t,e.chooseData=t,e.$refs.tem.detail=t,e.$refs.tem.getDetail()}):(this.oldData.$cellEdit=!1,this.$set(t,"$cellEdit",!0),this.oldData=t,this.chooseData=t,this.$refs.tem.detail=t,this.$refs.tem.getDetail())},save:function(){for(var t=0;t<this.changeList.length;t++)if(!this.changeList[t].yinId||!this.changeList[t].yinType)return void this.$tip.error("入仓编号/类型不能为空!");this.changeList.forEach(function(t,e){"null"===t.finStatus&&(t.finStatus=""),t.whseFinishedclothinoid?Object(r.L)(t).then(function(t){}):Object(r.a)(t).then(function(t){})}),this.getData(),this.$tip.success("保存成功!")},close:function(){document.getElementsByClassName("el-dialog__headerbtn")[0].click()},choiceData:function(t){if(0!==c()(t).length){for(var e in this.oldData.$cellEdit=!1,this.choiceTarget.custCode=t.custCode,this.choiceTarget[this.choiceField]=t[this.choiceField],this.oldData.$cellEdit=!0,t)delete t[e];for(var e in this.choiceQ)delete this.choiceQ[e];this.choiceV=!1}else this.choiceV=!1}},created:function(){},mounted:function(){},beforeDestroy:function(){}},D={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"rc"}},[i("view-container",{attrs:{title:t.data.type.split("_")[0]}},[i("div",{staticClass:"btnList"},[i("el-button",{attrs:{type:"warning"},on:{click:function(e){t.ruleV=!0}}},[t._v("編號規則配置")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.getData}},[t._v("查询")]),t._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:t.close}},[t._v("关闭")])],1),t._v(" "),i("div",{staticClass:"formBox"},[i("avue-form",{ref:"form",attrs:{option:t.everyThing.mainF},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}})],1),t._v(" "),i("el-row",{staticClass:"crudBox"},[i("el-col",{attrs:{span:13}},[i("view-container",{attrs:{title:t.data.type.split("_")[0]+"入库"}},[i("div",{staticClass:"btnList"},[i("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("新增")]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:t.del}},[t._v("删除")]),t._v(" "),i("el-button",{attrs:{type:"success",disabled:0===t.changeList.length},on:{click:t.save}},[t._v("保存")])],1),t._v(" "),i("avue-crud",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"crud",staticStyle:{"margin-top":"-5px"},attrs:{id:"crud",option:t.everyThing.mainC,data:t.crud,page:t.page},on:{"update:page":function(e){t.page=e},"on-load":t.getData,"current-row-change":t.cellClick}})],1)],1),t._v(" "),i("el-col",{attrs:{span:11}},[i("view-container",{attrs:{title:t.data.type.split("_")[0]+"入库明细"}},[i("tem-dlg",{ref:"tem",attrs:{datas:t.data,everyThing:t.everyThing,hide:t.hide}})],1)],1)],1),t._v(" "),t.ruleV?i("el-dialog",{attrs:{id:"wkRuleDlg",visible:t.ruleV,width:"50%","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(e){t.ruleV=e}}},[i("rule-dlg",{ref:"rule",attrs:{rcType:"whse_In_finished"},on:{close:function(e){t.ruleV=!1}}})],1):t._e(),t._v(" "),t.choiceV?i("choice",{attrs:{choiceV:t.choiceV,choiceTle:t.choiceTle,choiceQ:t.choiceQ,dlgWidth:"60%"},on:{choiceData:t.choiceData,close:function(e){t.choiceV=!1}}}):t._e()],1)],1)},staticRenderFns:[]};var v=i("VU/8")(y,D,!1,function(t){i("rQw3")},null,null);e.default=v.exports},SFsc:function(t,e){},rQw3:function(t,e){}});
//# sourceMappingURL=2.3cf55f013862af3db9d4.js.map