webpackJsonp([16],{kEKZ:function(t,e){},nZJk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("bOdI"),s=i.n(a);function n(t){var e=new Date(t),i=e.getFullYear(),a=e.getMonth()+1;a=a<10?"0"+a:a;var s=e.getDate();s=s<10?"0"+s:s;var n=e.getHours();n=n<10?"0"+n:n;var o=e.getMinutes();o=o<10?"0"+o:o;var l=e.getSeconds();return i+"-"+a+"-"+s+" "+n+":"+o+":"+(l=l<10?"0"+l:l)}function o(t,e,i){"string"==typeof t&&(t=Number(t));var a=new Date(t),s=a.getTime(),n=null,o=(n=(s+=3600*(a.getTimezoneOffset()/60+8)*1e3)?13===s.toString().length?s.toString():10===s.toString().length?s+"000":null:null)?new Date(parseInt(n)):new Date,l=o.getFullYear(),r=o.getMonth()>8?o.getMonth()+1:"0"+(o.getMonth()+1),c=o.getDate()>9?o.getDate():"0"+o.getDate(),d=(o.getHours()>9?o.getHours():o.getHours(),o.getMinutes()>9?o.getMinutes():o.getMinutes(),o.getSeconds()>9?o.getSeconds():o.getSeconds(),"");return d=i?i+d:{ym:l+"-"+r,d:c},n?d:""}var l={name:"",components:{},props:{tle:String,order:Object},data:function(){return{}},watch:{},methods:{close:function(){this.$emit("close")}},created:function(){},mounted:function(){console.log(this.order)},beforeDestroy:function(){}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"orderPlanDlg"}},[i("view-container",{attrs:{title:t.tle}},[i("div",{staticClass:"btnList"},[i("el-button",{attrs:{type:"primary"},on:{click:t.close}},[t._v(" 关 闭")])],1),t._v(" "),i("el-row",{staticClass:"content"},[i("div",{staticClass:"orderList"},[i("el-card",{attrs:{shadow:"hover"}},[i("div",{staticClass:"borderBox"},[i("div",[t._v("订单编号: "+t._s(t.order.poNo))]),t._v(" "),i("div",[t._v("客户: "+t._s(t.order.cust))]),t._v(" "),i("div",[t._v("重量: "+t._s(t.order.weight)+" KG")]),t._v(" "),i("div",[t._v("开始日期: "+t._s(t.order.start))]),t._v(" "),i("div",[t._v("结束日期: "+t._s(t.order.end))])])])],1),t._v(" "),i("div",{staticClass:"workerBox"},t._l(t.order.orderDetail,function(e){return i("div",{key:e.oid,staticClass:"workerList"},[i("div",{staticClass:"workerTle"},[i("span",[t._v("\n              "+t._s(e.color+"   "+e.weight+"KG, 已完成 "+e.weight*e.jd+"KG, "+100*e.jd+"%"))])]),t._v(" "),t._l(e.gx,function(e){return i("div",{key:e.oid,staticClass:"workerMain"},[i("div",{staticClass:"workerLabel"},[i("div",[t._v("缸号："+t._s(e.code))]),t._v(" "),i("div",[t._v("\n                生产时间："+t._s(2*e.long+"h , "+e.weight+"KG")+"\n              ")]),t._v(" "),i("div",[t._v("运行："+t._s(e.long+"h,"+100*e.jd+"%"))])]),t._v(" "),i("div",{staticClass:"workerBorder"},t._l(e.task,function(a){return i("div",{key:a.oid,staticClass:"taskBox",style:{width:100/e.task.length+"%"}},[i("div",{staticClass:"taskName"},[t._v("\n                  "+t._s(a.name)+"\n                  "),i("span",{staticClass:"loadingTle",attrs:{title:"共需"+a.long+"h, 運行"+a.long*a.jd+"h"}},[t._v("\n                    共需"+t._s(a.long+"h, 運行"+a.long*a.jd)+"h\n                  ")])]),t._v(" "),i("div",{staticClass:"taskS"},[i("div",{staticClass:"taskJd",style:{width:100*a.jd+"%"}}),t._v(" "),i("div",{staticClass:"taskTle"},[t._v("\n                    "+t._s(100*a.jd+"%")+"\n                  ")])])])}),0)])})],2)}),0)])],1)],1)},staticRenderFns:[]};var c=i("VU/8")(l,r,!1,function(t){i("wNdN")},null,null).exports,d=i("mtWM"),h=i.n(d);var v={name:"",components:{worker:c},data:function(){return{order:[],gant:[],dateList:[],dateLength:0,dayW:40,ganttH:35,dlgData:{},lineCtr:!0,loading:!1,workerDlg:!1,orderData:{},chooseData:{}}},watch:{},methods:{getData:function(){var t,e=this;h()({url:"/api/schANDschetail",method:"get",params:t}).then(function(t){e.order=t.data,console.log(e.order);var i=[];e.order.forEach(function(t,e){var a,s,o,l,r;i.push((a=t.proSalSchedule,s="schStart",o="schEnd",l="",r="",a.forEach(function(t,e){null!=t[s]&&null!=t[o]&&(0===e&&(r=t[s].valueOf(),l=t[o].valueOf()),t[s].valueOf()>l.valueOf()&&(l=t[s]),t[o].valueOf()>l.valueOf()&&(l=t[o]),t[s].valueOf()<r.valueOf()&&(r=t[s]),t[o].valueOf()<r.valueOf()&&(r=t[o]))}),r=n(new Date(r).valueOf()-1296e6),{maxResult:l=n(new Date(l).valueOf()+1296e6),minResult:r}))});var a={minResult:i.sort(function(t,e){return e.minResult<t.minResult?1:-1})[0].minResult,maxResult:i.sort(function(t,e){return e.maxResult<t.maxResult?-1:1})[0].maxResult};a.minResult=a.minResult.split(" ")[0]+" 00:00:00",e.dateLength=function(t,e){t=t.split(" ")[0],e=e.split(" ")[0];var i=t.split("-"),a=e.split("-"),s=new Date,n=[];s.setUTCFullYear(i[0],i[1]-1,i[2]);var l=new Date;l.setUTCFullYear(a[0],a[1]-1,a[2]);for(var r=s.getTime(),c=l.getTime(),d=r;d<=c;)n.push(o(d)),d+=864e5;return n}(a.minResult,a.maxResult),e.dateList=e.arrGroup(e.dateLength,"ym"),e.order.forEach(function(t,i){t.weight=0,t.actualWeight=0,t.finishProportion=0,t.proSalSchedule.forEach(function(i){i.show=!1,i.icon="el-icon-caret-right";var a=[];i.proSalScheduleDetailEx.forEach(function(t){a=a.concat(t.proSalScheduleDetail)});var s=[],n=[],o=0,l=0;(a=e.arrGroup(a,"workName")).forEach(function(t){var e=0,i=0;t.list.forEach(function(t){e+=t.exampleUseTime/60,i+=t.exampleUseTime*t.finishProportion/60,o+=t.exampleUseTime/60,l+=t.exampleUseTime*t.finishProportion/60}),n.push({workName:t.workName,sn:-1!=t.workName.indexOf("备")?1:-1!=t.workName.indexOf("成品")?-1!=t.workName.indexOf("验")?4:3:2,exampleUseTime:i,finishProportion:(i/e).toFixed(2)}),s.push({workName:t.workName,sn:-1!=t.workName.indexOf("备")?1:-1!=t.workName.indexOf("成品")?-1!=t.workName.indexOf("验")?4:3:2,exampleUseTime:e})}),i.finishProportion=l/o,i.zhList=n,i.proSalScheduleDetailEx.forEach(function(t){var e=[];s.forEach(function(i,a){var s=!0;t.proSalScheduleDetail.forEach(function(a,n){i.workName===a.workName?(e.push(a),s=!1):n===t.proSalScheduleDetail.length-1&&s&&e.push({workName:"无",exampleUseTime:0})}),t.taskList=e})}),t.weight+=i.proAmount,t.actualWeight+=i.proAmount*i.finishProportion,t.finishProportion+=i.finishProportion,t.proUnit=i.proUnit,i.taskList=s});var s=(new Date(t.poDate).valueOf()-new Date(a.minResult).valueOf())/36e5,n=(new Date(a.maxResult).valueOf()-1296e6-new Date(t.poDate).valueOf())/36e5;e.gant.push({item:t,ml:s,lg:n,h:2,choose:!1,detail:t.proSalSchedule,show:!1,icon:"el-icon-caret-right",label:"染整订单: "+t.poNo+" , "+t.weight+t.proUnit+",    完成 "+(t.actualWeight/t.weight*100).toFixed(2)+"%"})})})},arrGroup:function(t,e){for(var i={},a=[],n=0;n<t.length;n++){var o,l=t[n];if(i[l[e]])for(var r=0;r<a.length;r++){var c=a[r];if(c[e]==l[e]){c.list.push(l);break}}else a.push((o={},s()(o,e,l[e]),s()(o,"list",[l]),o)),i[l[e]]=l}return a},showDetali:function(t){t.show=!t.show,"el-icon-caret-right"===t.icon?t.icon="el-icon-caret-bottom":t.icon="el-icon-caret-right"},showLv2Detali:function(t){t.show=!t.show,"el-icon-caret-right"===t.icon?t.icon="el-icon-caret-bottom":t.icon="el-icon-caret-right"},showDlg:function(t){var e=this;this.loading=!0,this.dlgData=t.item,setTimeout(function(){e.loading=!1},200)},showWorker:function(t){this.orderData=t.item,this.workerDlg=!0},choose:function(t){this.chooseData.choose=!1,t.choose=!0,this.chooseData=t}},created:function(){this.getData()},mounted:function(){},beforeDestroy:function(){}},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"proOrder"}},[i("view-container",{attrs:{title:"订单查询"}},[i("div",{staticClass:"main"},[i("div",{staticClass:"box"},[i("div",{staticClass:"header"},t._l(t.dateList,function(e,a){return i("div",{key:a,staticClass:"dateBox"},[i("div",{staticClass:"dateTle"},[t._v("\n              "+t._s(e.ym)+"\n            ")]),t._v(" "),i("div",{staticClass:"dayBox"},t._l(e.list,function(e){return i("div",{key:e.d,staticClass:"day",style:{width:t.dayW+"px"}},[i("div",{staticClass:"dayTle"},[t._v(t._s(e.d))])])}),0)])}),0),t._v(" "),i("div",{staticClass:"contentBox",style:{width:t.dateLength.length*t.dayW+25+"px"}},[i("div",{staticClass:"content"},t._l(t.dateList,function(e,a){return i("div",{key:a,staticClass:"dayLine"},[i("div",{staticClass:"lineBox"},t._l(e.list,function(e){return i("div",{key:e.d,staticClass:"lineD",style:{width:t.dayW-1+"px","border-right":t.lineCtr?"1px dashed #ccc":"none",height:8*t.order.length*t.ganttH*1.5+"px"}})}),0)])}),0),t._v(" "),i("div",{directives:[{name:"drap",rawName:"v-drap",value:{x:"box",y:"contentBox"},expression:"{ x: 'box', y: 'contentBox' }"}],staticClass:"ganttBox",style:{width:t.dateLength.length*t.dayW+"px",height:(t.order.length+1)*t.ganttH*1.5+"px"}},t._l(t.gant,function(e,a){return i("div",{key:a,staticClass:"gantt",style:{"margin-top":t.ganttH/2+"px"}},[i("div",{staticClass:"lv1",style:{width:e.lg*t.dayW/24+"px","margin-left":e.ml*t.dayW/24+"px","font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px","box-shadow":e.choose?"0 0 5px rgba(81, 203, 238, 1)":"none"},on:{click:function(i){return t.choose(e)}}},[i("div",{staticClass:"iconList",style:{height:t.ganttH+"px","line-height":t.ganttH+"px"}},[i("i",{class:e.icon,style:{"line-height":t.ganttH+"px","font-size":t.ganttH/1.5>26?"26px":t.ganttH/1.5+"px"},attrs:{title:"展开"},on:{click:function(i){return t.showDetali(e)}}}),t._v(" "),i("el-popover",{attrs:{placement:"left-start",width:"260",trigger:"click"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"proOrderDlg",style:{"font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px"}},[i("div",[t._v("订单编号: "+t._s(t.dlgData.poNo))]),t._v(" "),i("el-divider"),t._v(" "),i("div",[t._v("客户: "+t._s(t.dlgData.brandId))]),t._v(" "),i("el-divider"),t._v(" "),i("div",[t._v("重量: "+t._s(t.dlgData.weight))]),t._v(" "),i("el-divider"),t._v(" "),i("div",[t._v("开始日期: "+t._s(t.dlgData.poDate))]),t._v(" "),i("el-divider"),t._v(" "),i("div",[t._v("结束日期: "+t._s(t.dlgData.end))]),t._v(" "),i("el-divider"),t._v(" "),t._l(e.detail,function(a,s){return i("div",{key:s},[t._v("\n                        "+t._s(a.colorName+":  "+a.proAmount+a.proUnit)+"\n                        "),s!=e.detail.length-1?i("el-divider"):t._e()],1)})],2),t._v(" "),i("div",{attrs:{slot:"reference"},slot:"reference"},[i("i",{staticClass:"el-icon-s-order",staticStyle:{"margin-left":"5px"},style:{"line-height":t.ganttH+"px","font-size":t.ganttH/1.5>26?"26px":t.ganttH/1.5+"px"},attrs:{title:"详细信息"},on:{click:function(i){return t.showDlg(e)}}})])])],1),t._v(" "),i("div",{staticClass:"schedule",style:{width:e.lg*e.item.actualWeight/e.item.weight*t.dayW/24+"px",height:t.ganttH+"px","line-height":t.ganttH+"px"}},[i("div",{staticStyle:{"min-width":"80px","text-align":"center"},style:{width:e.lg*t.dayW/24+"px"},attrs:{title:e.item.poNo+", 共"+e.item.weight+e.item.proUnit+", 完成"+(e.item.actualWeight/e.item.weight*100).toFixed(2)+"%"}},[t._v("\n                    "+t._s(e.item.poNo+", 共"+e.item.weight+e.item.proUnit+", 完成"+(e.item.actualWeight/e.item.weight*100).toFixed(2)+"%")+"\n                  ")])]),t._v(" "),i("span",{staticClass:"gtLabel",style:{"font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px","line-height":t.ganttH+"px",left:e.lg*t.dayW/24+"px"},attrs:{title:e.label}},[t._v("\n                  "+t._s(e.label)+"\n                ")]),t._v(" "),i("el-collapse-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"gt.show"}],staticClass:"detailBox",style:{width:e.lg*t.dayW/24-2+"px","margin-top":t.ganttH+"px","box-shadow":e.choose?"0 0 10px rgba(81, 203, 238, 1)":"none"}},t._l(e.detail,function(a,s){return i("div",{key:s,staticClass:"detail"},[i("div",{staticClass:"detailGantt",style:{width:100*a.finishProportion+"%",height:t.ganttH+"px","line-height":t.ganttH+"px","font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px"},attrs:{title:100*a.finishProportion+"%"}},[i("div",[i("span",{staticClass:"lv2-icon"},[i("i",{class:a.icon,style:{"line-height":t.ganttH+"px","font-size":t.ganttH/1.5>26?"26px":t.ganttH/1.5+"px"},attrs:{title:"展开"},on:{click:function(e){return t.showLv2Detali(a)}}})]),t._v(" "),i("div",{staticClass:"lv2Label"},[i("span",{attrs:{title:a.colorName+", 共"+a.proAmount+a.proUnit+", 完成"+100*a.finishProportion+"% "}},[t._v(t._s(a.colorName+", 共"+a.proAmount+a.proUnit+", 完成"+100*a.finishProportion+"% "))])])]),t._v(" "),i("div",{staticClass:"detailLabel",style:{left:e.lg*t.dayW/24+20+"px","line-height":t.ganttH+"px","font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px"},attrs:{title:a.colorName+" , "+a.proAmount+a.proUnit+"  完成:"+100*a.finishProportion+"%"}},[t._v("\n                          "+t._s(a.colorName+" , "+a.proAmount+a.proUnit+"  完成:"+100*a.finishProportion+"%")+"\n                        ")])]),t._v(" "),i("el-collapse-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:a.show,expression:"detail.show"}],staticClass:"lv3Box"},[i("div",{staticClass:"lv2Box",staticStyle:{background:"#67c23a"},style:{height:Math.ceil(.7*t.ganttH)+"px","line-height":Math.ceil(.7*t.ganttH)+"px"}},[i("div",{staticClass:"lv3Type",style:{height:Math.ceil(.7*t.ganttH)+1+"px"},attrs:{title:"缸號"}},[t._v("\n                              缸號\n                            ")]),t._v(" "),t._l(a.taskList,function(e){return i("div",{key:e.workName,staticClass:"lv2Task",style:{width:"calc(100% /"+a.taskList.length+")"}},[i("div",{staticClass:"lv2TaskLabel",attrs:{title:e.workName+", 共"+e.exampleUseTime.toFixed(1)+"h"}},[t._v("\n                                "+t._s(e.workName)+"\n                                "),i("span",{staticStyle:{"font-size":"13px"}},[t._v(t._s("共"+e.exampleUseTime.toFixed(1)+"h"))])])])})],2),t._v(" "),i("div",{staticClass:"lv2Box",style:{height:Math.ceil(.7*t.ganttH)+"px","line-height":Math.ceil(.7*t.ganttH)+"px"}},[i("div",{staticClass:"lv3Type",attrs:{title:"综合"}},[t._v("綜合")]),t._v(" "),t._l(a.zhList,function(e){return i("div",{key:e.oid,staticClass:"lv2Task",style:{width:"calc(100% /"+a.zhList.length+")"},attrs:{title:(100*e.finishProportion).toFixed(1)+"%"+e.exampleUseTime.toFixed(1)+"h"}},[i("div",{staticClass:"lv2TaskLabel"},[t._v("\n                                "+t._s(100*e.finishProportion+"% "+e.exampleUseTime.toFixed(1)+"h")+"\n                              ")]),t._v(" "),i("div",{staticStyle:{background:"#67c23a",height:"100%"},style:{width:100*e.finishProportion+"%"}})])}),t._v(" "),i("span",{staticClass:"lv3Label",style:{"font-size":t.ganttH/2.2>20?"20px":t.ganttH/2.2+"px"}},[t._v(t._s("綜合, 完成"+100*a.finishProportion+"%"))])],2),t._v(" "),t._l(a.proSalScheduleDetailEx,function(e,s){return i("div",{key:e.detailId,staticClass:"lv3Jd",style:{height:Math.ceil(.7*t.ganttH)+"px","line-height":Math.ceil(.7*t.ganttH)+"px"}},[i("div",{staticClass:"lv3length",style:{height:Math.ceil(.7*t.ganttH)+"px"}},[i("div",{staticClass:"lv3Type",attrs:{title:e.stepCode}},[t._v("\n                                "+t._s(e.stepCode)+"\n                              ")]),t._v(" "),t._l(e.taskList,function(e){return i("div",{key:e.stepId,staticClass:"gxBox",style:{width:"calc(100% /"+a.taskList.length+")"}},[i("div",{staticClass:"taskBox",style:{width:"无"===e.workName?"0px":100*e.finishProportion+"%","line-height":Math.ceil(.7*t.ganttH)+"px"},attrs:{title:e.workName+(e.exampleUseTime/60*e.finishProportion).toFixed(1)+"h,"+100*e.finishProportion+"%"}},[i("span",{staticClass:"taskTle"},[t._v("\n                                    "+t._s("无"===e.workName?"":100*e.finishProportion+"%")+"\n                                    "),"无"!=e.workName?i("span",{staticStyle:{"font-size":"13px"}},[t._v(t._s((e.exampleUseTime/60*e.finishProportion).toFixed(1)+"h"))]):t._e()])])])})],2),t._v(" "),i("span",{staticClass:"lv3Label",style:{"line-height":t.ganttH+"px",height:t.ganttH+"px",top:(s+2)*t.ganttH*.75+"px"}},[t._v("\n                              "+t._s("缸號: "+e.stepCode+", 完成"+100*e.finishProportion+"%")+"\n                            ")])])})],2)])],1)}),0)])],1)])}),0)])]),t._v(" "),i("el-row",{staticClass:"otherBox"},[i("el-dialog",{attrs:{visible:t.workerDlg,fullscreen:"","append-to-body":"",id:"proOrder"},on:{"update:visible":function(e){t.workerDlg=e}}},[i("worker",{attrs:{tle:"订单工序查询",order:t.orderData},on:{close:function(e){t.workerDlg=!1}}})],1)],1)],1)])],1)},staticRenderFns:[]};var p=i("VU/8")(v,g,!1,function(t){i("kEKZ")},null,null);e.default=p.exports},wNdN:function(t,e){}});
//# sourceMappingURL=16.0d906d0c620be32882da.js.map